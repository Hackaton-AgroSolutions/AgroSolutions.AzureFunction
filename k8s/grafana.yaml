apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
data:
  datasource.yaml: |
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus:9090

      - name: Loki
        type: loki
        access: proxy
        url: http://loki:3100

      - name: InfluxDB
        type: influxdb
        access: proxy
        url: http://agrosolutions-ingest-influxdb:8086
        isDefault: true
        jsonData:
          version: Flux
          organization: agrosolutions-org
          defaultBucket: agrosolutions-bucket
        secureJsonData:
          token: Je2LUfYXX9o10pAcYgzsG8tWeRlR5qwKjpAqlV_sf-HyD09G2-eG90yyOXWa6tNVDtwKzq_zshT6XXd4FYBi3A==
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-provisioning
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
      - name: 'Sensors'
        type: file
        options:
          path: /var/lib/grafana/dashboards

      - name: 'Weather - São Paulo'
        type: file
        options:
          path: /var/lib/grafana/dashboards
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
data:
  alerting.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "panels": [
        {
          "fieldConfig": {
            "defaults": {},
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 12,
            "x": 0,
            "y": 0
          },
          "id": 3,
          "options": {
            "alertInstanceLabelFilter": "",
            "alertName": "",
            "dashboardAlerts": false,
            "folder": {
              "title": "alerts/",
              "uid": "afed1kjqj95ogd"
            },
            "groupBy": [],
            "groupMode": "default",
            "maxItems": 20,
            "showInactiveAlerts": true,
            "sortOrder": 1,
            "stateFilter": {
              "error": true,
              "firing": false,
              "noData": true,
              "normal": true,
              "pending": true,
              "recovering": true
            },
            "viewMode": "stat"
          },
          "pluginVersion": "12.4.0",
          "title": "Total Normal Alerts",
          "type": "alertlist"
        },
        {
          "fieldConfig": {
            "defaults": {},
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 12,
            "x": 12,
            "y": 0
          },
          "id": 2,
          "options": {
            "alertInstanceLabelFilter": "",
            "alertName": "",
            "dashboardAlerts": false,
            "groupBy": [],
            "groupMode": "default",
            "maxItems": 20,
            "showInactiveAlerts": false,
            "sortOrder": 1,
            "stateFilter": {
              "error": false,
              "firing": true,
              "noData": false,
              "normal": false,
              "pending": false,
              "recovering": false
            },
            "viewMode": "stat"
          },
          "pluginVersion": "12.4.0",
          "title": "Total Firing Alerts",
          "type": "alertlist"
        },
        {
          "fieldConfig": {
            "defaults": {},
            "overrides": []
          },
          "gridPos": {
            "h": 17,
            "w": 12,
            "x": 0,
            "y": 4
          },
          "id": 4,
          "options": {
            "alertInstanceLabelFilter": "",
            "alertName": "",
            "dashboardAlerts": false,
            "groupBy": [],
            "groupMode": "custom",
            "maxItems": 20,
            "showInactiveAlerts": false,
            "sortOrder": 1,
            "stateFilter": {
              "error": true,
              "firing": false,
              "noData": true,
              "normal": true,
              "pending": true,
              "recovering": true
            },
            "viewMode": "list"
          },
          "pluginVersion": "12.4.0",
          "title": "Pending Alerts",
          "type": "alertlist"
        },
        {
          "fieldConfig": {
            "defaults": {},
            "overrides": []
          },
          "gridPos": {
            "h": 17,
            "w": 12,
            "x": 12,
            "y": 4
          },
          "id": 1,
          "options": {
            "alertInstanceLabelFilter": "",
            "alertName": "",
            "dashboardAlerts": false,
            "groupBy": [],
            "groupMode": "custom",
            "maxItems": 20,
            "showInactiveAlerts": false,
            "sortOrder": 1,
            "stateFilter": {
              "error": true,
              "firing": true,
              "noData": false,
              "normal": false,
              "pending": true,
              "recovering": true
            },
            "viewMode": "list"
          },
          "pluginVersion": "12.4.0",
          "title": "Firing Alerts",
          "type": "alertlist"
        }
      ],
      "preload": false,
      "schemaVersion": 42,
      "tags": [],
      "templating": {
        "list": []
      },
      "time": {
        "from": "now-6h",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "browser",
      "title": "Grafana Sensors Alerts",
      "uid": "aglqnrq",
      "version": 14,
      "weekStart": ""
    }

  all-sensors-alerts.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "panels": [
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "dark-red",
                "mode": "fixed"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "hideFrom": {
                  "viz": false
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "message"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 789
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Field ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 95
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Fired At"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 207
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 20,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 1,
          "options": {
            "cellHeight": "sm",
            "showHeader": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "datasource": {
                "type": "influxdb",
                "uid": "P951FEA4DE68E13C5"
              },
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -30d)\r\n  |> filter(fn: (r) => r._measurement == \"alerts\")\r\n  |> filter(fn: (r) => r._field == \"message\")\r\n  |> group(columns: [])\r\n  |> keep(columns: [\"_time\", \"field_id\", \"_value\"])\r\n  |> rename(columns: {_value: \"Message\"})\r\n  |> rename(columns: {_time: \"Fired At\"})\r\n  |> rename(columns: {field_id: \"Field ID\"})\r\n",
              "refId": "A"
            }
          ],
          "title": "All Alerts",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "Field ID": 0,
                  "Fired At": 1,
                  "Message": 2
                },
                "renameByName": {}
              }
            }
          ],
          "type": "table"
        }
      ],
      "preload": false,
      "schemaVersion": 42,
      "tags": [],
      "templating": {
        "list": []
      },
      "time": {
        "from": "now-6h",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "browser",
      "title": "All Sensor Alerts",
      "uid": "ags8f4w",
      "version": 4,
      "weekStart": ""
    }

  sensors.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 3,
          "panels": [],
          "title": "Sensor ${sensor_client_id}",
          "type": "row"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 24,
            "x": 0,
            "y": 1
          },
          "id": 4,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "datasource": {
                "type": "influxdb",
                "uid": "P951FEA4DE68E13C5"
              },
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -30d)\r\n  |> filter(fn: (r) => r._measurement == \"agro_sensors\")\r\n  |> filter(fn: (r) => r.sensor_client_id == \"${sensor_client_id}\")\r\n  |> pivot(rowKey:[\"_time\"], columnKey: [\"_field\"], valueColumn: \"_value\")\r\n  |> keep(columns: [\r\n      \"_time\",\r\n      \"soil_moisture_percent\",\r\n      \"air_temperature_c\",\r\n      \"precipitation_mm\",\r\n      \"air_humidity_percent\",\r\n      \"soil_ph\",\r\n      \"wind_speed_kmh\",\r\n      \"data_quality_score\"\r\n  ])\r\n  |> rename(columns: {\r\n      \"soil_moisture_percent\": \"Soil Moisture (%)\",\r\n      \"air_temperature_c\": \"Air Temp (°C)\",\r\n      \"precipitation_mm\": \"Precipitation (mm)\",\r\n      \"air_humidity_percent\": \"Air Humidity (%)\",\r\n      \"soil_ph\": \"Soil pH\",\r\n      \"wind_speed_kmh\": \"Wind Speed (km/h)\",\r\n      \"data_quality_score\": \"Data Quality\"\r\n  })",
              "refId": "A"
            }
          ],
          "title": "Datas",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 11
          },
          "id": 6,
          "panels": [],
          "title": "Field ${field_id}",
          "type": "row"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": "P951FEA4DE68E13C5"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [
                {
                  "options": {
                    "1": {
                      "index": 0,
                      "text": "Drought Alert"
                    },
                    "2": {
                      "index": 1,
                      "text": "Plague Risk"
                    },
                    "3": {
                      "index": 2,
                      "text": "Sensor with Low Data Quality"
                    },
                    "4": {
                      "index": 3,
                      "text": "Heat Wave – Potential Impact on Production"
                    },
                    "5": {
                      "index": 4,
                      "text": "High Probability of Fungal Diseases"
                    },
                    "6": {
                      "index": 5,
                      "text": "High Acidity with Potential for Reduced Nutrient Absorption"
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "light-blue",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 12
          },
          "id": 5,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/.*/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -30d)\r\n  |> filter(fn: (r) => \r\n    r._measurement == \"agro_sensors\" and\r\n    r._field == \"status_id\" and\r\n    r.field_id == \"${field_id}\"\r\n  )\r\n  |> last()\r\n  |> keep(columns: [\"field_id\", \"_value\"])\r\n  |> rename(columns: {_value: \"status_id\"})",
              "refId": "A"
            }
          ],
          "title": "Status",
          "type": "stat"
        },
        {
          "datasource": {
            "uid": "InfluxDB"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "hideFrom": {
                  "viz": false
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Date Time"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 203
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 12
          },
          "id": 7,
          "options": {
            "cellHeight": "sm",
            "showHeader": true,
            "sortBy": [
              {
                "desc": false,
                "displayName": "message {field_id=\"1\", sensor_client_id=\"618f91d3-be15-4773-9eef-089262b60293\"}"
              }
            ]
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -30d)\r\n  |> filter(fn: (r) => r._measurement == \"alerts\")\r\n  |> filter(fn: (r) => r.field_id == \"${field_id}\")\r\n  |> filter(fn: (r) => r._field == \"message\")\r\n  |> group(columns: [])\r\n  |> keep(columns: [\"_time\", \"_value\"])\r\n  |> rename(columns: {_time: \"Fired At\"})\r\n  |> rename(columns: {_value: \"Message\"})",
              "refId": "A"
            }
          ],
          "title": "Alerts",
          "type": "table"
        }
      ],
      "preload": false,
      "schemaVersion": 42,
      "tags": [],
      "templating": {
        "list": [
          {
            "current": {
              "text": "618f91d3-be15-4773-9eef-089262b60293",
              "value": "618f91d3-be15-4773-9eef-089262b60293"
            },
            "datasource": {
              "type": "influxdb",
              "uid": "P951FEA4DE68E13C5"
            },
            "definition": "import \"influxdata/influxdb/schema\"\r\n\r\nschema.tagValues(\r\n  bucket: \"agrosolutions-bucket\",\r\n  tag: \"sensor_client_id\"\r\n)",
            "label": "Sensor Identifier",
            "name": "sensor_client_id",
            "options": [],
            "query": {
              "query": "import \"influxdata/influxdb/schema\"\r\n\r\nschema.tagValues(\r\n  bucket: \"agrosolutions-bucket\",\r\n  tag: \"sensor_client_id\"\r\n)"
            },
            "refresh": 1,
            "regex": "",
            "regexApplyTo": "value",
            "type": "query"
          },
          {
            "current": {
              "text": "1",
              "value": "1"
            },
            "datasource": {
              "type": "influxdb",
              "uid": "P951FEA4DE68E13C5"
            },
            "definition": "import \"influxdata/influxdb/schema\"\r\n\r\nschema.tagValues(\r\n  bucket: \"agrosolutions-bucket\",\r\n  tag: \"field_id\"\r\n)",
            "label": "Field Identifier",
            "name": "field_id",
            "options": [],
            "query": {
              "query": "import \"influxdata/influxdb/schema\"\r\n\r\nschema.tagValues(\r\n  bucket: \"agrosolutions-bucket\",\r\n  tag: \"field_id\"\r\n)"
            },
            "refresh": 1,
            "regex": "",
            "regexApplyTo": "value",
            "type": "query"
          }
        ]
      },
      "time": {
        "from": "2026-02-26T01:49:36.604Z",
        "to": "2026-02-26T01:49:36.605Z"
      },
      "timepicker": {},
      "timezone": "browser",
      "title": "Sensors2",
      "uid": "agcdsz22",
      "version": 9,
      "weekStart": ""
    }

  weather-sao-paulo-dashboard.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "grafana",
              "uid": "-- Grafana --"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "type": "dashboard"
          }
        ]
      },
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "links": [],
      "panels": [
        {
          "collapsed": true,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 14,
          "panels": [],
          "title": "Current",
          "type": "row"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-YlRd"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 3,
            "x": 0,
            "y": 1
          },
          "id": 1,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -24h)\r\n  |> filter(fn: (r) => r._measurement == \"weather_current\")\r\n  |> filter(fn: (r) => r.city == \"sao_paulo\")\r\n  |> filter(fn: (r) => r._field == \"temperature\")\r\n  |> last()",
              "refId": "A"
            }
          ],
          "title": "Temperature (Cº)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 3,
            "x": 3,
            "y": 1
          },
          "id": 6,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -24h)\r\n  |> filter(fn: (r) => r._measurement == \"weather_current\")\r\n  |> filter(fn: (r) => r.city == \"sao_paulo\")\r\n  |> filter(fn: (r) => r._field == \"humidity\")\r\n  |> last()",
              "refId": "A"
            }
          ],
          "title": "Humidity (%)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "#071fde",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 6,
            "y": 1
          },
          "id": 2,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -24h)\r\n  |> filter(fn: (r) => r._measurement == \"weather_current\")\r\n  |> filter(fn: (r) => r.city == \"sao_paulo\")\r\n  |> filter(fn: (r) => r._field == \"precipitation\")\r\n  |> last()",
              "refId": "A"
            }
          ],
          "title": "Precipitation (mm)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 10,
            "y": 1
          },
          "id": 7,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -24h)\r\n  |> filter(fn: (r) => r._measurement == \"weather_current\")\r\n  |> filter(fn: (r) => r.city == \"sao_paulo\")\r\n  |> filter(fn: (r) => r._field == \"rain_probability\")\r\n  |> last()",
              "refId": "A"
            }
          ],
          "title": "Rain Probability (%)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "#ffffff",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 4,
            "x": 14,
            "y": 1
          },
          "id": 3,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -24h)\r\n  |> filter(fn: (r) => r._measurement == \"weather_current\")\r\n  |> filter(fn: (r) => r.city == \"sao_paulo\")\r\n  |> filter(fn: (r) => r._field == \"wind_speed\")\r\n  |> last()",
              "refId": "A"
            }
          ],
          "title": "Wind Speed (km/h)",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 5,
            "w": 6,
            "x": 18,
            "y": 1
          },
          "id": 4,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^weather_desc sao_paulo$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "from(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: -24h)\r\n  |> filter(fn: (r) => r._measurement == \"weather_current\")\r\n  |> filter(fn: (r) => r._field == \"weather_desc\")\r\n  |> last()",
              "refId": "A"
            }
          ],
          "title": "Weather Condition",
          "type": "stat"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 6
          },
          "id": 13,
          "panels": [],
          "title": "Next 7 Days",
          "type": "row"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 7
          },
          "id": 5,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "import \"experimental\"\r\n\r\nfrom(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: now(), stop: experimental.addDuration(d: 7d, to: now()))\r\n  |> filter(fn: (r) => r._measurement == \"weather_forecast\")\r\n  |> filter(fn: (r) => r._field == \"temperature\")\r\n  |> sort(columns: [\"_time\"])",
              "refId": "A"
            }
          ],
          "title": "Temperature",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 7
          },
          "id": 8,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "import \"experimental\"\r\n\r\nfrom(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: now(), stop: experimental.addDuration(d: 7d, to: now()))\r\n  |> filter(fn: (r) => r._measurement == \"weather_forecast\")\r\n  |> filter(fn: (r) => r._field == \"humidity\")\r\n  |> sort(columns: [\"_time\"])",
              "refId": "A"
            }
          ],
          "title": "Humidity",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 7
          },
          "id": 9,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "import \"experimental\"\r\n\r\nfrom(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: now(), stop: experimental.addDuration(d: 7d, to: now()))\r\n  |> filter(fn: (r) => r._measurement == \"weather_forecast\")\r\n  |> filter(fn: (r) => r._field == \"precipitation\")\r\n  |> sort(columns: [\"_time\"])",
              "refId": "A"
            }
          ],
          "title": "Precipitation",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 15
          },
          "id": 10,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "import \"experimental\"\r\n\r\nfrom(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: now(), stop: experimental.addDuration(d: 7d, to: now()))\r\n  |> filter(fn: (r) => r._measurement == \"weather_forecast\")\r\n  |> filter(fn: (r) => r._field == \"rain_probability\")\r\n  |> sort(columns: [\"_time\"])",
              "refId": "A"
            }
          ],
          "title": "Rain Probability",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 15
          },
          "id": 11,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "import \"experimental\"\r\n\r\nfrom(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: now(), stop: experimental.addDuration(d: 7d, to: now()))\r\n  |> filter(fn: (r) => r._measurement == \"weather_forecast\")\r\n  |> filter(fn: (r) => r._field == \"wind_speed\")\r\n  |> sort(columns: [\"_time\"])",
              "refId": "A"
            }
          ],
          "title": "Wind Speed",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "influxdb",
            "uid": null
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "hideFrom": {
                  "viz": false
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Time"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 251
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 15
          },
          "id": 12,
          "options": {
            "cellHeight": "sm",
            "showHeader": true,
            "sortBy": [
              {
                "desc": false,
                "displayName": "Time"
              }
            ]
          },
          "pluginVersion": "12.4.0",
          "targets": [
            {
              "query": "import \"experimental\"\r\n\r\nfrom(bucket: \"agrosolutions-bucket\")\r\n  |> range(start: now(), stop: experimental.addDuration(d: 7d, to: now()))\r\n  |> filter(fn: (r) => r._measurement == \"weather_forecast\")\r\n  |> filter(fn: (r) => r._field == \"weather_desc\")\r\n  |> sort(columns: [\"_time\"])",
              "refId": "A"
            }
          ],
          "title": "Weather Condition",
          "type": "table"
        }
      ],
      "preload": false,
      "refresh": "5s",
      "schemaVersion": 42,
      "tags": [],
      "templating": {
        "list": []
      },
      "time": {
        "from": "2026-03-02T05:00:00.000Z",
        "to": "2026-03-03T03:00:00.000Z"
      },
      "timepicker": {},
      "timezone": "browser",
      "title": "Weather - São Paulo",
      "uid": "ad8vjdc",
      "version": 49,
      "weekStart": ""
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
  template:
    metadata:
      labels:
        app: grafana
    spec:
      containers:
        - name: grafana
          image: grafana/grafana:latest
          ports:
            - containerPort: 3000
          env:
            - name: GF_SECURITY_ADMIN_USER
              value: agrosolutions-grafana-admin
            - name: GF_SECURITY_ADMIN_PASSWORD
              value: agrosolutionsGrafanaAdmin123$
            - name: INFLUXDB_TOKEN
              value: Je2LUfYXX9o10pAcYgzsG8tWeRlR5qwKjpAqlV_sf-HyD09G2-eG90yyOXWa6tNVDtwKzq_zshT6XXd4FYBi3A==
          volumeMounts:
            - name: grafana-datasources
              mountPath: /etc/grafana/provisioning/datasources

            - name: grafana-dashboard-provisioning
              mountPath: /etc/grafana/provisioning/dashboards

            - name: grafana-dashboards
              mountPath: /var/lib/grafana/dashboards
      volumes:
        - name: grafana-datasources
          configMap:
            name: grafana-datasources

        - name: grafana-dashboard-provisioning
          configMap:
            name: grafana-dashboard-provisioning

        - name: grafana-dashboards
          configMap:
            name: grafana-dashboards
---
apiVersion: v1
kind: Service
metadata:
  name: grafana
spec:
  selector:
    app: grafana
  ports:
    - port: 3000
      targetPort: 3000
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: grafana-pvc
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 1Gi